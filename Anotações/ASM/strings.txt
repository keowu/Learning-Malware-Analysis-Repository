Conteúdo de anotações das páginas 148 - 150

- Strings
Uma strings é um array de caractéres. quando é definido uma strings, nada mais acontece do que usar-se um array
de char, e no final desse array temos um NULL terminator, cada byte na memória ocupa exatos 1 byte(usando um termo
mais simples cada caractére ASCII ocupa 1 Byte de tamanho).

A string com o nome de str do exemplo abaixo é uma variável de ponteiro que aponta ao primeiro caractére da string
considere como a base de um array de caractéres, o seguinte diagramas é representado o funcionamento de uma string 
na memória:

   			 ___________________________________        Endereço
			|									| 
			|				  -					|          ;
			|___________________________________|
			|									|           
			|			     \0					|          ;
			|___________________________________|
			|                                   |
	str[2]	|                 t                 |         0x4002
			|___________________________________|
			|                                   |
	str[1]	|                 e                 |         0x4001
			|___________________________________|
			|									|
	str[0]	|				  L					|         0x4000
			|___________________________________|
			|                                   |
			|                 -                 |
			|___________________________________|
			|                                   |
			|                 -                 |
            |___________________________________|
            |                                   |
    str     |              0x4000               |	 	  0x3FF4
            |                                   |
            |___________________________________|


Do exemplo usado, é possível acessar elementos do array de caractéres como mostrado:

str[0] = [str + 0] = [0x4000 + 0] = [0x4000] = L 
str[1] = [str + 1] = [0x4000 + 1] = [0x4001] = E
str[2] = [str + 2] = [0x4000 + 2] = [0x4002] = T

A forma geral como caractéres são representados no array é representado a seguir

str[i] = [str+i]


- Instruções de strings


A familia de processadores x86 provem de instruções strings, no qual usam o operador de string, essas instruções usam um sufix de b, w e d no qual indicam
o tamanho do dado para operar, no (1, 2 ou 4 bytes). a instrução de string  usam os registradores EAX, ESI e EDI. O registrador EAX, ou subregistradores
como ax, e al são usados para valors menores. O registrador ESI é o endereço de registrador de origem e EDI é o registrador de destino.

Depois de fazer a operação com a string, os registradores ESI e o EDI são automaticamente incrementados ou decrementados(Imagine ESI e EDI como um index da origem)
A Flag de Direção(DF) nos registradores EFLAGS determinam se ESI é DF = 0, e se DF = 0, então o registrador de index(ESI e EDI) são incrementados, a instrução std
define as flags de direção (DF = 1); na maioria dos casos, ESI e EDI são decrementados.

- Movendo da Memoria para Memoria (movsx)

A instrição MOVSX é usada para mover uma sequencia de bytes de uma localização da memória para outra. A instrução movsb é usada para mover 1 byte do endereço especificado
pelo registrador ESI, para o endereço especificado pelo registrador EDI, A movsw, movsd movem 2 e 4 bytes de um endereço especificado por ESI para um endereço especificado por EDI.
depois que o valor for movido os registradores ESI e EDI são incrementados e decrementados, com 1, 2 ou 4 bytes, baseado no tamanho do dado, no seguinte exemplo de código Assembly
vamos assumir que o endereço chamado de origem contenha a string "Good", seguido de um NULL Terminator (0x00 | \x0).
Depois de executar a primeira instrução (1) ESI vai conter o endereço para o início da string "Good", (2) vai setar EDI para conter o endereço do buffer de memória (dst), (3) vai
copiar 1 byte(o caractére G) do endereço especificado por ESI para o especificado por EDI, depois de executar as instruções. (3) ESI e EDI serão incrementados em 1, para armazenar o próximo endereço.

(1) lea ESI, [src] ; "Good", 0x00
(2) lea EDI, [dst]
(3) movsb

O seguinte diagrama vai ajudar você a entender oque acontece depois de executar a instrução movsb da (3). ao inves de movsb, se movsw tivesse sido usado, então 2 bytes seriam
copiados da origem para o destino, e ESI e EDI, seriam incrementados com 2:




Antes de executar a instrução movsb:

   			 ___________________________________        Endereço
			|									| 
			|				  -					|          ;
			|___________________________________|
			|									|           
			|			     \0					|          ;
			|___________________________________|
			|                                   |
			|                 D                 |          ;
			|___________________________________|
			|                                   |
			|                 O                 |         0x4002
			|___________________________________|
			|									|
			|				  O					|         0x4001
			|___________________________________|
			|                                   |
	ESI ->	|                 G                 |		  0x4000
			|___________________________________|
			|                                   |
			|                 -                 |
            |___________________________________|
            |                                   |
			|              0x4000               |	 	  0x3FF4
            |                                   |
            |___________________________________|



   			 ___________________________________        Endereço
			|									| 
			|				  -					|          ;
			|___________________________________|
			|									|           
			|			      .					|          ;
			|___________________________________|
			|                                   |
			|                 .                 |         0x4052
			|___________________________________|
			|                                   |
			|                 .                 |         0x4051
			|___________________________________|
			|									|
	ESI ->	|				  .					|         0x4050
			|___________________________________|
			|                                   |
			|                 .                 |
			|___________________________________|
			|                                   |
			|                 .                 |
            |___________________________________|
            |                                   |
			|                 .	                |
            |                                   |
            |___________________________________|




Depois de executar movsb


   			 ___________________________________        Endereço
			|									| 
			|				  -					|          ;
			|___________________________________|
			|									|           
			|			     \0					|          ;
			|___________________________________|
			|                                   |
			|                 D                 |          ;
			|___________________________________|
			|                                   |
			|                 O                 |         0x4002
			|___________________________________|
			|									|
	ESI ->	|				  O					|         0x4001
			|___________________________________|
			|                                   |
			|                 G                 |		  0x4000
			|___________________________________|
			|                                   |
			|                 -                 |
            |___________________________________|
            |                                   |
			|                 -                 |	 	  
            |                                   |
            |___________________________________|
			
			
			


   			 ___________________________________        Endereço
			|									| 
			|				  -					|          ;
			|___________________________________|
			|									|           
			|			      -					|          ;
			|___________________________________|
			|                                   |
			|                 -                 |          ;
			|___________________________________|
			|                                   |
			|                 -                 |         0x4052
			|___________________________________|
			|									|
	ESI ->	|				  -					|         0x4051
			|___________________________________|
			|                                   |
			|                 G                 |		  0x4050
			|___________________________________|
			|                                   |
			|                 -                 |
            |___________________________________|
            |                                   |
			|                 -                 |	 	  
            |                                   |
            |___________________________________|
			
			

